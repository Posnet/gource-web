<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gource Web - Git Repository Visualizer</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Visualize your Git repository history as an animated tree directly in your browser. No installation required - runs entirely client-side using WebAssembly.">
    <meta name="keywords" content="gource, git, visualization, repository, history, commits, webassembly, wasm, github, version control">
    <meta name="author" content="Gource Web">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://gource.denialof.services/">
    <meta property="og:title" content="Gource Web - Git Repository Visualizer">
    <meta property="og:description" content="Visualize your Git repository history as an animated tree directly in your browser. No installation required.">
    <meta property="og:image" content="https://gource.denialof.services/og-image.png">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://gource.denialof.services/">
    <meta name="twitter:title" content="Gource Web - Git Repository Visualizer">
    <meta name="twitter:description" content="Visualize your Git repository history as an animated tree directly in your browser. No installation required.">
    <meta name="twitter:image" content="https://gource.denialof.services/og-image.png">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" type="image/png" href="favicon.png">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://gource.denialof.services/">

    <link rel="stylesheet" href="gource.css">
</head>
<body>
    <div id="container">
        <canvas id="canvas" oncontextmenu="event.preventDefault()" tabindex="1"></canvas>
        <div id="loading">
            <div class="spinner"></div>
            <p>Loading Gource...</p>
        </div>
        <div id="controls">
            <input type="file" id="logFile" accept=".log,.txt" style="display: none;">
            <button id="githubBtn" class="github-btn">
                <svg height="16" viewBox="0 0 16 16" width="16" fill="currentColor">
                    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                </svg>
                <span id="githubBtnText">Login with GitHub</span>
            </button>
            <button id="loadBtn">Load Git Log</button>
            <button id="demoBtn">Load Demo</button>
            <button id="helpBtn" class="help-btn">?</button>
            <span id="fps"></span>
        </div>
    </div>

    <!-- Load Git Log Modal -->
    <div id="loadLogModal" class="modal">
        <div class="modal-content load-log-modal-content">
            <span class="modal-close" id="loadLogModalClose">&times;</span>
            <h2>Load Git Log</h2>
            <p class="modal-description">Generate a git log from your repository using this command:</p>
            <div class="cli-command" id="cliCommand">
                <code>git log --pretty=format:"%at|%an|%ae" --reverse --name-status</code>
                <span class="copy-hint">Click to copy</span>
            </div>
            <p class="modal-description">Then select the output file:</p>
            <button id="selectFileBtn" class="select-file-btn">Select Log File</button>
        </div>
    </div>

    <!-- Repo Selector Modal -->
    <div id="repoModal" class="modal">
        <div class="modal-content repo-modal-content">
            <span class="modal-close" id="repoModalClose">&times;</span>
            <h2>Select Repository</h2>
            <div id="repoUrlInput" class="repo-url-section">
                <input type="text" id="repoUrlField" placeholder="Paste GitHub URL (e.g. https://github.com/owner/repo)">
                <button id="repoUrlBtn">Clone</button>
            </div>
            <div id="repoSearchSection">
                <div class="repo-divider"><span>or select from your repos</span></div>
                <div id="repoSearch">
                    <input type="text" id="repoSearchInput" placeholder="Search repositories...">
                </div>
            </div>
            <div id="repoList" class="repo-list">
                <div class="loading-repos">Loading repositories...</div>
            </div>
            <div id="repoProgress" class="repo-progress hidden">
                <div class="progress-text">Fetching commits...</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 0%"></div>
                </div>
                <div class="progress-detail"></div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2>Keyboard Controls</h2>
            <div class="controls-grid">
                <div class="control-section">
                    <h3>Playback</h3>
                    <div class="control-row"><kbd>Space</kbd> Pause/Resume</div>
                    <div class="control-row"><kbd>+</kbd> / <kbd>-</kbd> Speed up/down</div>
                    <div class="control-row"><kbd>.</kbd> / <kbd>,</kbd> Time scale up/down</div>
                    <div class="control-row"><kbd>/</kbd> Reset time scale</div>
                    <div class="control-row"><kbd>N</kbd> Skip to next activity</div>
                </div>
                <div class="control-section">
                    <h3>Camera</h3>
                    <div class="control-row"><kbd>V</kbd> Toggle camera mode</div>
                    <div class="control-row"><kbd>Arrow Keys</kbd> Pan camera</div>
                    <div class="control-row"><kbd>Scroll</kbd> Zoom in/out</div>
                    <div class="control-row"><kbd>Tab</kbd> Cycle through users</div>
                </div>
                <div class="control-section">
                    <h3>Display</h3>
                    <div class="control-row"><kbd>K</kbd> Toggle file extension key</div>
                    <div class="control-row"><kbd>M</kbd> Toggle mouse visibility</div>
                    <div class="control-row"><kbd>U</kbd> Cycle usernames</div>
                    <div class="control-row"><kbd>F</kbd> Cycle filenames</div>
                    <div class="control-row"><kbd>D</kbd> Cycle directory names</div>
                    <div class="control-row"><kbd>T</kbd> Toggle tree</div>
                    <div class="control-row"><kbd>G</kbd> Toggle users</div>
                </div>
                <div class="control-section">
                    <h3>Other</h3>
                    <div class="control-row"><kbd>S</kbd> Randomize colors</div>
                    <div class="control-row"><kbd>Q</kbd> Toggle debug info</div>
                </div>
            </div>
        </div>
    </div>

    <!-- isomorphic-git for cloning through CORS proxy -->
    <script src="vendor/buffer.min.js"></script>
    <script>window.Buffer = buffer.Buffer;</script>
    <script src="vendor/lightning-fs.min.js"></script>
    <script src="vendor/isomorphic-git.min.js"></script>
    <script src="vendor/isomorphic-git-http.min.js"></script>

    <script src="gource-web.js"></script>
    <script type="module" src="gource.js"></script>
    <script>
        // Auto-load demo if ?demo query param is present
        if (window.location.search.includes('demo')) {
            window.addEventListener('load', () => {
                setTimeout(() => {
                    if (window.GourceWeb) {
                        window.GourceWeb.loadLogFromUrl('demo.log');
                    }
                }, 1000);
            });
        }

        // Demo button handler
        document.getElementById('demoBtn').addEventListener('click', () => {
            if (window.GourceWeb) {
                window.GourceWeb.loadLogFromUrl('demo.log');
            }
        });

        // Help modal handlers
        const helpModal = document.getElementById('helpModal');
        const helpBtn = document.getElementById('helpBtn');
        const helpCloseBtn = helpModal.querySelector('.modal-close');

        helpBtn.addEventListener('click', () => {
            openModal('helpModal');
        });

        helpCloseBtn.addEventListener('click', () => {
            closeModal('helpModal');
        });

        helpModal.addEventListener('click', (e) => {
            if (e.target === helpModal) {
                closeModal('helpModal');
            }
        });

        // Global escape key handler for all modals
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && isModalOpen()) {
                document.querySelectorAll('.modal.show').forEach(modal => {
                    closeModal(modal.id);
                });
            }
        });
    </script>
</body>
</html>
